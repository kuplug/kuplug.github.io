<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>PDF Viewer Sederhana (Sinkron & Alert Akurat)</title>
<style>
  :root{--bg:#0f172a;--panel:#111827;--muted:#9ca3af;--text:#e5e7eb;--btn:#1f2937;--btnH:#374151;--border:#1f2937;--ring:0 0 0 2px rgba(34,211,238,.35)}
  *{box-sizing:border-box} body{margin:0;background:linear-gradient(180deg,#0b1020,#0f172a);color:var(--text);font:14px/1.5 system-ui,Segoe UI,Roboto,Ubuntu,Helvetica,Arial}
  header{position:sticky;top:0;z-index:10;background:rgba(15,23,42,.6);backdrop-filter:saturate(130%) blur(6px);border-bottom:1px solid var(--border)}
  .wrap{max-width:1000px;margin:auto;padding:12px}.title{display:flex;gap:12px;align-items:center;justify-content:space-between}
  .title h1{margin:0;font-size:16px}.hint{color:var(--muted);font-size:12px}
  .viewport{position:relative;background:var(--panel);border:1px solid var(--border);border-radius:12px;overflow:hidden;box-shadow:0 8px 30px rgba(0,0,0,.35)}
  .stage{position:relative;min-height:60vh;display:grid;place-items:center}
  iframe{width:100%;height:72vh;border:0;background:#0b1020}
  .toolbar{display:flex;gap:8px;flex-wrap:wrap;align-items:center;padding:10px;background:rgba(17,24,39,.85);border-top:1px solid var(--border)}
  .group{display:flex;gap:6px;align-items:center}
  .btn{appearance:none;border:1px solid #273244;background:var(--btn);color:var(--text);padding:8px 10px;border-radius:10px;cursor:pointer;transition:.15s;display:inline-flex;gap:6px;align-items:center}
  .btn:hover{background:var(--btnH)} .btn[aria-pressed="true"]{box-shadow:var(--ring)}
  .pageField{width:76px;padding:7px 8px;border-radius:8px;border:1px solid #273244;background:#0b1224;color:var(--text)}
  select{padding:7px 8px;border-radius:8px;border:1px solid #273244;background:#0b1224;color:var(--text)}
  .fileName{color:var(--muted);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
  .overlay{position:absolute;inset:0;display:none;place-items:center;background:linear-gradient(180deg,rgba(2,6,23,.35),rgba(2,6,23,.6));backdrop-filter:blur(2px)}
  .overlay.show{display:grid}
</style>
</head>
<body>
<header>
  <div class="wrap title">
    <h1>üìÑ PDF Viewer</h1>
    <div class="hint">Navigasi & zoom sinkron ‚Ä¢ Alert saat benar-benar di halaman terakhir</div>
  </div>
</header>

<main class="wrap">
  <div class="viewport" id="viewport">
    <div class="stage">
      <div class="overlay" id="overlay"><span class="btn" aria-disabled="true">Memuat PDF‚Ä¶</span></div>
      <iframe id="pdfFrame" title="PDF"></iframe>
      <noscript>Aktifkan JavaScript untuk melihat PDF.</noscript>
    </div>

    <div class="toolbar">
      <div class="group">
        <button class="btn" id="firstPage" title="Halaman pertama">‚èÆ</button>
        <button class="btn" id="prevPage"  title="Sebelumnya">‚óÄ</button>
        <input class="pageField" type="number" id="pageInput" value="1" min="1" step="1" title="Nomor halaman"/>
        <button class="btn" id="nextPage"  title="Berikutnya">‚ñ∂</button>
        <button class="btn" id="lastPage"  title="Halaman terakhir">‚è≠</button>
      </div>

      <div class="group">
        <select id="zoomSelect" title="Zoom">
          <option value="page-width" selected>Fit Lebar</option>
          <option value="page-fit">Fit Halaman</option>
          <option value="100">100%</option>
          <option value="125">125%</option>
          <option value="150">150%</option>
          <option value="200">200%</option>
        </select>
      </div>

      <div class="group" style="margin-left:auto">
        <span class="fileName" id="fileName">-</span>
        <span class="fileName" id="pageTotal" title="Total halaman">(?)</span>
      </div>
    </div>
  </div>
</main>

<script>
/* ====== KONFIG ====== */
const PDF_SRC = "pdf01.pdf";         // ganti ke filemu (same-origin disarankan)
const DEFAULT_ZOOM = "page-width";
const MANUAL_TOTAL_PAGES = null;      // isi angka jika deteksi otomatis gagal (mis. 12)

/* ====== STATE ====== */
const S = { page: 1, zoom: DEFAULT_ZOOM, total: null, alertedLast: false };

const el = {
  frame: document.getElementById('pdfFrame'),
  overlay: document.getElementById('overlay'),
  pageInput: document.getElementById('pageInput'),
  zoomSelect: document.getElementById('zoomSelect'),
  fileName: document.getElementById('fileName'),
  pageTotal: document.getElementById('pageTotal'),
};

/* ====== UTIL ====== */
function showOverlay(v){ el.overlay.classList.toggle('show', !!v); }
function updateTotalsLabel(){
  el.pageTotal.textContent = S.total ? `(total: ${S.total})` : `(total: tidak diketahui)`;
}
function makeUrl(){
  // cache-buster di query agar iframe pasti reload, hash untuk page/zoom
  const q = PDF_SRC.includes('?') ? '&' : '?';
  const base = `${PDF_SRC}${q}_=${Date.now()}`;
  const hash = `#page=${S.page}&zoom=${encodeURIComponent(S.zoom)}`;
  return base + hash;
}
function load(){
  showOverlay(true);
  el.fileName.textContent = PDF_SRC;
  el.frame.src = makeUrl();
}

/* ====== DETEKSI TOTAL HALAMAN (best-effort, tanpa library) ======
   - Membaca PDF sebagai teks Latin-1 dan menghitung '/Type /Page' (bukan '/Pages').
   - Butuh same-origin atau CORS yang mengizinkan. */
async function detectTotalPages(){
  if (typeof MANUAL_TOTAL_PAGES === 'number' && MANUAL_TOTAL_PAGES > 0){
    S.total = MANUAL_TOTAL_PAGES; updateTotalsLabel(); return;
  }
  try{
    const res = await fetch(PDF_SRC, {cache:'no-store'});
    if(!res.ok) throw new Error('fetch gagal');
    const buf = await res.arrayBuffer();
    const txt = new TextDecoder('latin1').decode(buf);
    // hitung '/Type /Page' dengan word boundary; hindari '/Pages'
    const matches = txt.match(/\/Type\s*\/Page\b/g);
    if (matches && matches.length > 0){
      S.total = matches.length;
    }
  }catch(e){
    // biarkan S.total = null bila gagal (CORS/struktur PDF)
  }finally{
    updateTotalsLabel();
  }
}

/* ====== PARAM RELOAD & SINKRON ====== */
function reloadParams(){
  // Set nomor halaman sesuai input; iframe diarahkan ke #page yang sama.
  el.frame.src = makeUrl();
  // Hard replace (jika same-origin) agar viewer benar-benar pindah:
  try{ el.frame.contentWindow?.location.replace?.(el.frame.src); }catch{}
}

/* ====== ALERT LAST PAGE ====== */
function alertLast(){
  if (S.total && S.page >= S.total){
    if(!S.alertedLast){ alert(`‚úÖ Anda sudah di halaman terakhir (${S.total}).`); S.alertedLast = true; }
    return true;
  }
  return false;
}

/* ====== NAVIGASI HALAMAN ====== */
function firstPage(){ S.page = 1; S.alertedLast = false; el.pageInput.value='1'; reloadParams(); }
function prevPage(){
  S.page = Math.max(1, S.page-1);
  S.alertedLast = false;
  el.pageInput.value = String(S.page);
  reloadParams();
}
function nextPage(){
  // Jika tahu total, tahan di last & alert
  if (S.total && S.page >= S.total){
    S.page = S.total; el.pageInput.value = String(S.page);
    alertLast(); return;
  }
  S.page += 1;
  el.pageInput.value = String(S.page);
  reloadParams();
  if (S.total && S.page === S.total){ alertLast(); }
}
function lastPage(){
  if (S.total){ S.page = S.total; }
  else { S.page += 0; /* tanpa total: tetap di page sekarang */ }
  el.pageInput.value = String(S.page);
  reloadParams();
  alertLast();
}
function setPageFromInput(){
  const v = parseInt(el.pageInput.value || '1', 10);
  let newPage = isNaN(v) ? 1 : Math.max(1, v);
  if (S.total) newPage = Math.min(newPage, S.total);
  S.page = newPage;
  el.pageInput.value = String(S.page);
  S.alertedLast = false;
  reloadParams();
}

/* ====== ZOOM ====== */
function setZoom(z){ S.zoom = z; reloadParams(); }

/* ====== EVENTS ====== */
document.getElementById('firstPage').onclick = firstPage;
document.getElementById('prevPage').onclick  = prevPage;
document.getElementById('nextPage').onclick  = nextPage;
document.getElementById('lastPage').onclick  = lastPage;
el.pageInput.addEventListener('change', setPageFromInput);
el.pageInput.addEventListener('keydown', e=>{ if(e.key==='Enter') setPageFromInput(); });
el.zoomSelect.onchange = ()=> setZoom(el.zoomSelect.value);
el.frame.addEventListener('load', ()=> showOverlay(false));
window.addEventListener('keydown', (e)=>{
  if(['ArrowRight','PageDown'].includes(e.key)){ e.preventDefault(); nextPage(); }
  if(['ArrowLeft','PageUp'].includes(e.key)){ e.preventDefault(); prevPage(); }
  if(e.key==='Home'){ e.preventDefault(); firstPage(); }
  if(e.key==='End'){ e.preventDefault(); lastPage(); }
});

/* ====== INIT ====== */
detectTotalPages();  // non-blocking; jika berhasil, alert & batas halaman jadi akurat
load();
</script>
</body>
</html>
